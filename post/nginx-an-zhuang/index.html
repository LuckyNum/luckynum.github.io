
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Nginx - å®‰è£… | ATOZ</title>
<meta name="description" content="Hello, World!">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://luckynum.github.io/favicon.ico?v=1555557744987">
<link rel="stylesheet" href="https://luckynum.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://luckynum.github.io">
        <img class="avatar" src="https://luckynum.github.io/images/avatar.png?v=1555557744987" alt="" width="32px" height="32px">
      </a>
      <a href="https://luckynum.github.io">
        <h1 class="site-title">ATOZ</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            å…³äº
          </a>
        
      
        
          <a href="/post/music/" class="menu purple-link">
            éŸ³ä¹ğŸµ
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">Nginx - å®‰è£…</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2019-04-18</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://luckynum.github.io/tag/3DT5dCuY4">
                    nginx
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p><em><strong>æ¨èä½¿ç”¨ç¬¬äºŒç§æºç ç¼–è¯‘å®‰è£…æ–¹å¼</strong></em></p>
<h2 id="1-yumå®‰è£…æ— æ³•å¢åŠ å…¶ä»–æ¨¡å—">1. yumå®‰è£…ï¼ˆæ— æ³•å¢åŠ å…¶ä»–æ¨¡å—ï¼‰</h2>
<ul>
<li>
<p><strong>å®‰è£…å‡†å¤‡</strong></p>
<ul>
<li>ç¯å¢ƒé…ç½®ï¼ˆcentos7ï¼‰</li>
</ul>
</li>
</ul>
<!-- more --> 
<pre><code class="language-shell"># å…³é—­é˜²ç«å¢™
systemctl firewalld stop
# å…³é—­selinux
getenforce
setenforce 0
</code></pre>
<ul>
<li>å®‰è£…å‡†å¤‡</li>
</ul>
<pre><code class="language-shell"># è½¯ä»¶å®‰è£…
yum -y install gcc gcc-c++ autoconf pcre pcre-devel make automake
[å¯é€‰] yum -y install wget httpd-tools vim
# åˆ›å»ºç›®å½•
mkdir /opt/nginx
cd /opt/nginx
mkdir app download logs work backup
</code></pre>
<ul>
<li>
<p><strong>å®‰è£…</strong></p>
<ul>
<li>ç‰ˆæœ¬åŒºåˆ«</li>
</ul>
<p>Mainline versionï¼šå¼€å‘ç‰ˆ</p>
<p>Stable versionï¼šç¨³å®šç‰ˆ</p>
<p>Legacy versionsï¼šå†å²ç‰ˆæœ¬</p>
<ul>
<li>é…ç½®yumæº</li>
</ul>
<blockquote>
<p>To set up the yum repository for RHEL/CentOS, create the file named /etc/yum.repos.d/nginx.repo with the following contents:</p>
<p>[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/
gpgcheck=0
enabled=1</p>
</blockquote>
<ul>
<li>å®‰è£…</li>
</ul>
<pre><code class="language-shell">yum list | grep nginx
yum -y install nginx
nginx -v æŸ¥çœ‹ç‰ˆæœ¬
nginx -V æŸ¥çœ‹é…ç½®å‚æ•°
</code></pre>
</li>
<li>
<p><strong>åŸºæœ¬å‚æ•°</strong></p>
<p>æŸ¥çœ‹ï¼šrpm -ql nginx</p>
</li>
</ul>
<h2 id="2-æºç å®‰è£…å¯ç¼–è¯‘å…¶ä»–æ¨¡å—">2. æºç å®‰è£…ï¼ˆå¯ç¼–è¯‘å…¶ä»–æ¨¡å—ï¼‰</h2>
<ul>
<li><strong>ä¸‹è½½</strong></li>
</ul>
<p>å®˜ç½‘ï¼šhttp://nginx.org/en/download.htmlï¼Œé€‰æ‹©Stable version</p>
<pre><code class="language-shell"># ä¸‹è½½
wget http://nginx.org/download/nginx-1.14.2.tar.gz
# è§£å‹
tar -zxvf nginx-1.14.2.tar.gz
</code></pre>
<p>ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="language-shell">nginx-1.14.2
â”œâ”€â”€ auto		ç¼–è¯‘æ—¶makeä½¿ç”¨
â”œâ”€â”€ CHANGES		change log
â”œâ”€â”€ CHANGES.ru	change log
â”œâ”€â”€ conf		é…ç½®æ ·ä¾‹
â”œâ”€â”€ configure	ç”Ÿæˆä¸­é—´æ–‡ä»¶
â”œâ”€â”€ contrib		å·¥å…·ï¼Œvimé«˜äº®æ˜¾ç¤ºï¼šcp -r contrib/vim/* ~/.vim/
â”œâ”€â”€ html		é»˜è®¤htmlæ–‡ä»¶
â”œâ”€â”€ LICENSE		è¯ä¹¦
â”œâ”€â”€ man			å¸®åŠ©æ–‡ä»¶
â”œâ”€â”€ README		è¯´æ˜æ–‡ä»¶
â””â”€â”€ src			æºä»£ç 
</code></pre>
<ul>
<li><strong>configure</strong></li>
</ul>
<pre><code class="language-shell"># æŸ¥çœ‹é…ç½®å‚æ•°
./configure --help | more
# é…ç½®/home/app/nginx
./configure --prefix=/home/app/nginx
</code></pre>
<p>ç”Ÿæˆä¸­é—´æ–‡ä»¶åœ¨objsä¸‹</p>
<pre><code class="language-shell">objs
â”œâ”€â”€ autoconf.err
â”œâ”€â”€ Makefile
â”œâ”€â”€ ngx_auto_config.h
â”œâ”€â”€ ngx_auto_headers.h
â”œâ”€â”€ ngx_modules.c		å†³å®šå“ªäº›æ¨¡å—ä¼šè¢«ç¼–è¯‘è¿›nginxäºŒè¿›åˆ¶æ–‡ä»¶ä¸­
â””â”€â”€ src
</code></pre>
<ul>
<li><strong>ç¼–è¯‘</strong></li>
</ul>
<pre><code class="language-shell"># ç¼–è¯‘
make
</code></pre>
<p>ç”Ÿæˆç¼–è¯‘ç»“æœåœ¨objsä¸‹ï¼š</p>
<pre><code class="language-shell">objs
â”œâ”€â”€ autoconf.err
â”œâ”€â”€ Makefile
â”œâ”€â”€ nginx				å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶
â”œâ”€â”€ nginx.8
â”œâ”€â”€ ngx_auto_config.h
â”œâ”€â”€ ngx_auto_headers.h
â”œâ”€â”€ ngx_modules.c
â”œâ”€â”€ ngx_modules.o
â””â”€â”€ src					cç¼–è¯‘ç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶
    â”œâ”€â”€ core
    â”œâ”€â”€ event
    â”œâ”€â”€ http
    â”œâ”€â”€ mail
    â”œâ”€â”€ misc
    â”œâ”€â”€ os
    â””â”€â”€ stream
</code></pre>
<ul>
<li><strong>å®‰è£…</strong>ï¼ˆé¦–æ¬¡å®‰è£…ä½¿ç”¨ï¼‰</li>
</ul>
<pre><code class="language-shell">make install
</code></pre>
<p>å®‰è£…åˆ°é…ç½®çš„è·¯å¾„<code>/home/app/nginx</code></p>
<pre><code class="language-shell">nginx
â”œâ”€â”€ conf							é…ç½®æ–‡ä»¶
â”‚Â Â  â”œâ”€â”€ fastcgi.conf
â”‚Â Â  â”œâ”€â”€ fastcgi.conf.default
â”‚Â Â  â”œâ”€â”€ fastcgi_params
â”‚Â Â  â”œâ”€â”€ fastcgi_params.default
â”‚Â Â  â”œâ”€â”€ koi-utf
â”‚Â Â  â”œâ”€â”€ koi-win
â”‚Â Â  â”œâ”€â”€ mime.types
â”‚Â Â  â”œâ”€â”€ mime.types.default
â”‚Â Â  â”œâ”€â”€ nginx.conf
â”‚Â Â  â”œâ”€â”€ nginx.conf.default
â”‚Â Â  â”œâ”€â”€ scgi_params
â”‚Â Â  â”œâ”€â”€ scgi_params.default
â”‚Â Â  â”œâ”€â”€ uwsgi_params
â”‚Â Â  â”œâ”€â”€ uwsgi_params.default
â”‚Â Â  â””â”€â”€ win-utf
â”œâ”€â”€ html							é»˜è®¤é¡µé¢
â”‚Â Â  â”œâ”€â”€ 50x.html
â”‚Â Â  â””â”€â”€ index.html
â”œâ”€â”€ logs							æ—¥å¿—ç›®å½•
â””â”€â”€ sbin							å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶
    â””â”€â”€ nginx
</code></pre>
<h2 id="3-å¯åœæ“ä½œ">3. å¯åœæ“ä½œ</h2>
<blockquote>
<p>Nginxæ”¯æŒ2ç§è¿›ç¨‹æ¨¡å‹<code>Single</code>å’Œ<code>Master-Worker</code></p>
<p>Singleæ˜¯å•è¿›ç¨‹ï¼Œä¸€èˆ¬ä¸é€‚ç”¨ï¼ŒMaster-Workeræ˜¯ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹æ¨¡å‹è¿è¡Œï¼Œä¸»è¿›ç¨‹å¯¹å·¥ä½œè¿›ç¨‹ç®¡ç†ã€‚</p>
<p>Nginxå…è®¸æˆ‘ä»¬é€šè¿‡ä¿¡å·æ¥æ§åˆ¶ä¸»è¿›ç¨‹ï¼Œç”¨ä¿¡å·çš„æ–¹å¼å¯ä»¥è¾¾åˆ°ä¸å½±å“ç°æœ‰è¿æ¥çš„ç›®çš„ã€‚</p>
</blockquote>
<p>nginxæ§åˆ¶æ–¹å¼ï¼šnginxè‡ªå¸¦å‘½ä»¤ï¼Œlinuxä¿¡å·æ§åˆ¶ã€‚ä¸¤è€…å¯é…åˆä½¿ç”¨ï¼ˆå¦‚çƒ­éƒ¨ç½²ï¼‰</p>
<h3 id="1nginxå‘½ä»¤è¡Œ">1.nginxå‘½ä»¤è¡Œ</h3>
<p>æ ¼å¼ï¼š<code>nginx -s reload</code></p>
<p>å¸®åŠ©ï¼š<code>-? -h</code></p>
<p>æŒ‡å®šé…ç½®æ–‡ä»¶ï¼š<code>-c</code></p>
<p>æŒ‡å®šè¿è¡Œç›®å½•ï¼š<code>-p</code>ï¼ˆæ›¿æ¢logsç­‰ç›®å½•ï¼‰</p>
<p>å‘é€ä¿¡å·ï¼š<code>-s</code> ï¼ˆç«‹å³åœæ­¢ï¼š<code>stop</code>ï¼Œä¼˜é›…çš„åœæ­¢ï¼š<code>quit</code>ï¼Œé‡è½½é…ç½®æ–‡ä»¶ï¼š<code>reload</code>ï¼Œé‡æ–°è®°å½•æ—¥å¿—ï¼š<code>reopen</code>ï¼‰</p>
<p>æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•ï¼š<code>-t -T</code></p>
<p>æ‰“å°ç‰ˆæœ¬ã€ç¼–è¯‘ä¿¡æ¯ï¼š<code>-v -V</code></p>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹ï¼š</strong></p>
<p><strong>1ï¼‰nginxå¯åŠ¨</strong></p>
<p>æŒ‡ä»¤ï¼šnginxç¨‹åº   -c   nginxé…ç½®æ–‡ä»¶</p>
<pre><code class="language-shell"># /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
</code></pre>
<p><strong>2ï¼‰nginxé‡å¯</strong></p>
<p>è¿›å…¥nginxå¯æ‰§è¡Œç¨‹åºçš„ç›®å½•</p>
<pre><code class="language-shell"># cd /usr/local/nginx/sbin/
# ./nginx -s reload
</code></pre>
<blockquote>
<p>nginx: [error] invalid PID number &quot;&quot; in &quot;/usr/local/nginx/logs/nginx.pid&quot;</p>
<p>é‡å¯æ˜¯å»ºç«‹åœ¨nginxæœåŠ¡å·²å¯åŠ¨</p>
</blockquote>
<p><strong>3ï¼‰nginxåœæ­¢</strong></p>
<pre><code class="language-shell"># ./nginx -s stop
# ./nginx -s quit
</code></pre>
<p><code>quit</code> æ˜¯ä¸€ä¸ªä¼˜é›…çš„å…³é—­æ–¹å¼ï¼ŒNginxåœ¨é€€å‡ºå‰å®Œæˆå·²ç»æ¥å—çš„è¿æ¥è¯·æ±‚</p>
<p><code>stop</code> æ˜¯å¿«é€Ÿå…³é—­ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚ã€‚</p>
<p><strong>4ï¼‰é‡æ–°æ‰“å¼€æ—¥å¿—</strong></p>
<pre><code class="language-shell"># ./nginx -s reopen
</code></pre>
<p><strong>5ï¼‰nginxæ£€æŸ¥é…ç½®æ–‡ä»¶</strong></p>
<p>æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</p>
<p>ç¬¬ä¸€ç§</p>
<p>è¿›å…¥nginxå¯æ‰§è¡Œç¨‹åºçš„ç›®å½•</p>
<pre><code class="language-shell"># cd /usr/local/nginx/sbin/
# ./nginx -t
</code></pre>
<p>ç¬¬äºŒç§</p>
<pre><code class="language-shell"># /usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.con
</code></pre>
<h3 id="2ä¿¡å·æ§åˆ¶">2.ä¿¡å·æ§åˆ¶</h3>
<p><strong>1ï¼‰ä¿¡å·ç±»å‹</strong></p>
<p>INTï¼ŒTERM			å¿«é€Ÿå…³é—­ä¿¡å·</p>
<p>QUIT				ä»å®¹å…³é—­ä¿¡å·</p>
<p>HUP				ä»å®¹é‡å¯ä¿¡å·ï¼Œä¸€èˆ¬ç”¨äºä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œé‡å¯</p>
<p>USR1				é‡è¯»æ—¥å¿—ï¼Œä¸€èˆ¬ç”¨äºæ—¥å¿—çš„åˆ‡å‰²</p>
<p>USR2				å¹³æ»‘å‡çº§ä¿¡å·</p>
<p>WINCH				ä»å®¹å…³é—­æ—§è¿›ç¨‹</p>
<p><strong>2ï¼‰å…·ä½“ä½¿ç”¨:</strong></p>
<p>kill    -ä¿¡å·é€‰é¡¹    nginxçš„ä¸»è¿›ç¨‹å·</p>
<p>ä¾‹ï¼š</p>
<pre><code class="language-shell">kill -INT 26661
kill -HUP 4873
</code></pre>
<ul>
<li><strong>nginxåœæ­¢</strong></li>
</ul>
<pre><code class="language-shell">ps -ef | grep nginx  #è·å¾—è¿›ç¨‹å·
</code></pre>
<p><em>ç¬¬1ç§ä»å®¹â€œä¼˜é›…â€åœæ­¢</em></p>
<pre><code class="language-shell"># kill -QUIT masterè¿›ç¨‹å·
# NginxæœåŠ¡å¯ä»¥æ­£å¸¸åœ°å¤„ç†å®Œå½“å‰æ‰€æœ‰è¯·æ±‚å†åœæ­¢æœåŠ¡
# æ­¥éª¤ï¼šé¦–å…ˆä¼šå…³é—­ç›‘å¬ç«¯å£ï¼Œåœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œç„¶åæŠŠå½“å‰æ­£åœ¨å¤„ç†çš„è¿æ¥å…¨éƒ¨å¤„ç†å®Œï¼Œæœ€åå†é€€å‡ºè¿›ç¨‹ã€‚
</code></pre>
<p><em>ç¬¬2ç§å¿«é€Ÿåœæ­¢</em></p>
<pre><code class="language-shell"># kill -TERM masterè¿›ç¨‹å·
# kill -INT masterè¿›ç¨‹å·
# å¿«é€Ÿåœæ­¢æœåŠ¡æ—¶ï¼Œworkerè¿›ç¨‹ä¸masterè¿›ç¨‹åœ¨æ”¶åˆ°ä¿¡å·åä¼šç«‹åˆ»è·³å‡ºå¾ªç¯ï¼Œé€€å‡ºè¿›ç¨‹ã€‚
</code></pre>
<p><em>ç¬¬3ç§å¼ºåˆ¶åœæ­¢</em></p>
<pre><code class="language-shell"># kill -9 nginx
# ç³»ç»Ÿå¼ºæ€nginxè¿›ç¨‹ 
</code></pre>
<ul>
<li><strong>é‡å¯nginx</strong></li>
</ul>
<pre><code class="language-shell"># kill -HUP masterè¿›ç¨‹å·
</code></pre>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://luckynum.github.io/post/zsh-an-zhuang-andpei-zhi">
              <h3 class="post-title">
                ä¸‹ä¸€ç¯‡ï¼šZSHå®‰è£…&amp;é…ç½®
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">Hello, World!</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
